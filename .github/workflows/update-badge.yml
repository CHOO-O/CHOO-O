name: Update README with latest blog post link

on:
  schedule:
    - cron: "0 15 * * *" # ë§¤ì¼ 0ì‹œ (KST ê¸°ì¤€)

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      # 1. í˜„ì¬ ë ˆí¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ
      - name: Checkout profile repo
        uses: actions/checkout@v3

      # 2. badge/ ë””ë ‰í„°ë¦¬ ìƒì„± ë° ë§í¬ í…ìŠ¤íŠ¸ ë‹¤ìš´ë¡œë“œ
      - name: Download latest link file
        run: |
          mkdir -p badge
          curl -s -o badge/latest-link.txt https://raw.githubusercontent.com/CHOO-O/CHOO-study/main/badge/latest-link.txt

      # 3. í˜„ì¬ READMEì— í¬í•¨ëœ ë§í¬ì™€ ë¹„êµ
      - name: Check if README needs update
        id: check
        run: |
          NEW_LINK=$(cat badge/latest-link.txt)
          grep -q "$NEW_LINK" README.md && echo "skip=true" >> $GITHUB_OUTPUT || echo "skip=false" >> $GITHUB_OUTPUT

      # 4. ë§í¬ ì¹˜í™˜ ë° ì»¤ë°‹
      - name: Update README.md with latest link
        if: steps.check.outputs.skip != 'true'
        run: |
          NEW_LINK=$(cat badge/latest-link.txt)
          sed -i "s|(<!--LATEST_LINK_START-->).*<!--LATEST_LINK_END-->|<!--LATEST_LINK_START-->${NEW_LINK}<!--LATEST_LINK_END-->|" README.md

          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add README.md
          git commit -m "ğŸ”„ Update latest blog post link"
          git push
