# 01. ì›Œí¬í”Œë¡œìš° ì´ë¦„ ì„¤ì •
name: Update latest post link in README

# 02. íŠ¸ë¦¬ê±°: ë§¤ì¼ ë°¤ 12ì‹œ (KST = 15:00 UTC)ì— ì‹¤í–‰
on:
  schedule:
    - cron: "0 15 * * *" # í•œêµ­ ì‹œê°„ ë°¤ 12ì‹œ
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

# 03. ì‘ì—… ì •ì˜
jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      # 03-01. ê¸°ë³¸ ë ˆí¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ
      - name: Checkout main repository (CHOO-O/CHOO-O)
        uses: actions/checkout@v3

      # 03-02. ë¸”ë¡œê·¸ ë ˆí¬ì§€í† ë¦¬ì—ì„œ ìµœì‹  ë§í¬ íŒŒì¼ë§Œ ê°€ì ¸ì˜¤ê¸°
      - name: Download latest-link.txt from blog repository
        run: |
          mkdir -p badge
          curl -s -o badge/latest-link.txt https://raw.githubusercontent.com/CHOO-O/CHOO-study/main/badge/latest-link.txt

      # 03-03. README.mdì˜ ì•µì»¤ ì£¼ì„ ì‚¬ì´ì˜ ë§í¬ ì¹˜í™˜
      - name: Replace latest link in README.md
        run: |
          LATEST_LINK=$(cat badge/latest-link.txt)

          # ë²”ìœ„ë¥¼ ì£¼ì„ ì•µì»¤ ê¸°ì¤€ìœ¼ë¡œ ì¹˜í™˜
          sed -i "/<!--LATEST_LINK_START-->/,/<!--LATEST_LINK_END-->/c\\<!--LATEST_LINK_START-->\n${LATEST_LINK}\n<!--LATEST_LINK_END-->" README.md

      # 03-04. ë³€ê²½ ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: Commit and push changes
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"

          git add README.md
          if git diff --cached --quiet; then
            echo "â No changes to commit"
          else
            git commit -m "ğŸ”„ Update latest blog post link in README"
            git push
          fi
