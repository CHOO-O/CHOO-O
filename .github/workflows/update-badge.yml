# 01. 워크플로우 이름 설정
name: Update latest post link in README

# 02. 트리거: 매일 밤 12시 (KST = 15:00 UTC)에 실행
on:
  schedule:
    - cron: "0 15 * * *" # 한국 시간 밤 12시
  workflow_dispatch: # 수동 실행도 가능

# 03. 작업 정의
jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      # 03-01. 기본 레포지토리 체크아웃
      - name: Checkout main repository (CHOO-O/CHOO-O)
        uses: actions/checkout@v3

      # 03-02. 블로그 레포지토리에서 최신 링크 파일만 가져오기
      - name: Download latest-link.txt from blog repository
        run: |
          mkdir -p badge
          curl -s -o badge/latest-link.txt https://raw.githubusercontent.com/CHOO-O/CHOO-study/main/badge/latest-link.txt

      # 03-03. README.md의 앵커 주석 사이의 링크 치환
      - name: Replace latest link in README.md
        run: |
          LATEST_LINK=$(cat badge/latest-link.txt)

          # 범위를 주석 앵커 기준으로 치환
          sed -i "/<!--LATEST_LINK_START-->/,/<!--LATEST_LINK_END-->/c\\<!--LATEST_LINK_START-->\n${LATEST_LINK}\n<!--LATEST_LINK_END-->" README.md

      # 03-04. 변경 사항 커밋 및 푸시
      - name: Commit and push changes
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"

          git add README.md
          if git diff --cached --quiet; then
            echo "❎ No changes to commit"
          else
            git commit -m "🔄 Update latest blog post link in README"
            git push
          fi
